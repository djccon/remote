<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8">
<style type="text/css">

.button {
   border-top: 1px solid #96d1f8;
   background: #65a9d7;
   background: -webkit-gradient(linear, left top, left bottom, from(#3e779d), to(#65a9d7));
   background: -webkit-linear-gradient(top, #3e779d, #65a9d7);
   background: -moz-linear-gradient(top, #3e779d, #65a9d7);
   background: -ms-linear-gradient(top, #3e779d, #65a9d7);
   background: -o-linear-gradient(top, #3e779d, #65a9d7);
   padding: 5.5px 11px;
   -webkit-border-radius: 40px;
   -moz-border-radius: 40px;
   border-radius: 40px;
   -webkit-box-shadow: rgba(0,0,0,1) 0 1px 0;
   -moz-box-shadow: rgba(0,0,0,1) 0 1px 0;
   box-shadow: rgba(0,0,0,1) 0 1px 0;
   text-shadow: rgba(0,0,0,.4) 0 1px 0;
   color: white;
   font-size: 16px;
   font-family: Helvetica, Arial, Sans-Serif;
   text-decoration: none;
   vertical-align: middle;
   }
.button:hover {
   border-top-color: #28597a;
   background: #28597a;
   color: #ccc;
   }
.button:active {
   border-top-color: #1b435e;
   background: #1b435e;
   }

div
{
	transition: transform 2s ;
	-moz-transition: transform 2s ; /* Firefox 4 */
	-webkit-transition: -webkit-transform 2s ; /* Safari and Chrome */
	-o-transition: transform 2s ; /* Opera */
}

div:hover
{
	width:300px;
}


#divFrame
{
	background-image: url('images/2010Cape-1-small.jpg'); 
	position: relative;
	height: 400px;
	width: 420px;
	margin: 00px;
	padding:0px;
	border: 1px solid black;
}

#divBall
{
	position: absolute;
	background-color: white;
	height: 10px;
	width: 10px;
	margin: 0px;
	padding: 0px;
	border: 1px solid black;
	-moz-transform: translate(200px, 380px); 
	-webkit-transform: translate(200px, 380px); 
}

#divClub
{
	background-image: url('images/iron_right_cropped_small.png'); 
	padding:0px;
	position: absolute;
	border: 0px solid black;
	background-color: red;
	height: 195px;
	width: 25px;

	-moz-transform: translate(190px, 200px) rotate(0deg); 
	-moz-transform-origin:75% 0%; 
	-webkit-transform: translate(190px, 200px) rotate(0deg); 
	-webkit-transform-origin:75% 0%; 
}


</style>

<script>
	var count = 0;
	var timerID = 0;
	var isSwinging = false;
	var doingBackswing = false;
	var doingDownswing = false;
	var power = 0;
	var direction = 0;
	var clubTranslation = "translate(190px, 200px)";
	
	function startSwing()
	{
		if (isSwinging)
		{
			return;
		}
		
		isSwinging = true;
		doingBackswing = true;

		var rotateString = "rotate(260deg)";		
		document.getElementById("divClub").style.MozTransform = clubTranslation + " " + rotateString;		
		document.getElementById("divClub").style.WebkitTransform = clubTranslation + " " + rotateString;	

		timerID = setInterval ( "onTimer()", 10 );
	}

	// Click top of backswing
	function registerPower()
	{
		if (!isSwinging)
		{
			return;
		}
		
		if (!doingBackswing)
		{
			return;
		}
		
		var rotateString = "rotate(-90deg)";
		document.getElementById("divClub").style.MozTransform = clubTranslation + " " + rotateString;		
		document.getElementById("divClub").style.WebkitTransform = clubTranslation + " " + rotateString;	

		power = count;
		
		doingBackswing = false;
		doingDownswing = true;
	}

	function registerDirection()
	{
		if (!isSwinging)
		{
			return;
		}
		
		if (!doingDownswing)
		{
			return;
		}
		
		clearTimeout(timerID);
		
		doingBackswing = false;
		doingDownswing = false;
		isSwinging = false;
		
		direction = count;
		
		//alert('Direction registered')
		
		sendCommandToServer();
	}

	var request;

	function sendCommandToServer()
	{
		var url = "api/send_swing_command";

		request = new XMLHttpRequest();
		request.open("PUT", url, true);

		power = Math.floor(power / 10);
		if (power > 15) {
			power = 15;
		}

		power = 151 + power;
		direction = 10501 + direction;

		document.getElementById("debug").value = "pwr: " + power + ", dir: " + direction;

		var params = "power=" + power + "&direction=" + direction;

		//Send the proper header information along with the request
		request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		request.setRequestHeader("Content-length", params.length);
		request.setRequestHeader("Connection", "close");

		request.onload = function() {
			if (request.status == 200) {
				console.log(request.responseText);
				document.getElementById("results").innerHTML = request.responseText;
			} else {
				alert(request.status + " " + request.statusText);
			}
		}

		request.onerror = function() {
			alert("error it");
		}

		request.send(params);
	}
	
	window.onload = function () 
	{
		
	}
	
	function onTimer()
	{
		if (doingBackswing)
		{
			count = count + 1;
		} else {
			count = count - 1;
		}		
	}

	function onSend()
	{
		request.send(params);
	}
	
	function onReset ()
	{
		clearTimeout(timerID);
		
		isSwinging = false;
		doingBackswing = false;
		doingDownswing = false;
		
		power = 0;
		direction = 0;
		
		count = 0;
		
		document.getElementById("debug").value = "";
		var rotateString = "rotate(" + (0 - count) + "deg)";
		document.getElementById("divClub").style.MozTransform = clubTranslation + " " + rotateString;
		document.getElementById("divClub").style.WebkitTransform = clubTranslation + " " + rotateString;
	}

</script>

</head>

<body>

<div id="divFrame">
  <div id="divClub"></div>
  <div id="divBall"></div>
</div>

<div id="divButtons">
	<button id="startButton" class="button" onclick="startSwing()" >Takeaway</button>
	<button class="button" onclick="registerPower()" >Top</button>
	<button class="button" onclick="registerDirection()" >Impact</button>
	<br>
	<button class="button" onclick="onReset()" >Reset</button>
	<!-- button class="button" onclick="onSend()" >Send</button -->
	<input id="debug" value="debug">
</div>

<div id="results">
	/* Results go here. */
</div>

</body>
</html>

